<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åšå®¢APIå®Œæ•´æµ‹è¯•é¡µé¢</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 30px;
    }
    .status-bar {
      background: #e8f5e8;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      border-left: 5px solid #4CAF50;
    }
    .section {
      margin: 25px 0;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
    }
    .endpoint-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    .endpoint-card {
      background: white;
      border-radius: 8px;
      padding: 15px;
      border: 1px solid #e0e0e0;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .method {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-weight: bold;
      font-size: 0.8em;
      margin-right: 8px;
    }
    .GET { background: #61affe; color: white; }
    .POST { background: #49cc90; color: white; }
    .PUT { background: #fca130; color: white; }
    .DELETE { background: #f93e3e; color: white; }
    .endpoint-path {
      font-family: monospace;
      margin: 8px 0;
      color: #333;
    }
    .test-btn {
      background: #007bff;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
      width: 100%;
    }
    .test-btn:hover {
      opacity: 0.9;
    }
    .result-area {
      margin-top: 30px;
    }
    #result {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Consolas', monospace;
      white-space: pre-wrap;
      word-wrap: break-word;
      max-height: 500px;
      overflow-y: auto;
      margin-top: 10px;
    }
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
      color: #007bff;
    }
    .token-section {
      background: #fff3cd;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .token-section input {
      width: 70%;
      padding: 8px;
      margin-right: 10px;
      border: 1px solid #ffc107;
      border-radius: 4px;
    }
    .auth-btn {
      background: #28a745;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
    }
    .tab {
      overflow: hidden;
      border-bottom: 1px solid #ccc;
      margin-bottom: 20px;
    }
    .tab button {
      background-color: inherit;
      float: left;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 14px 16px;
      transition: 0.3s;
      font-size: 16px;
    }
    .tab button:hover {
      background-color: #f1f1f1;
    }
    .tab button.active {
      border-bottom: 3px solid #007bff;
    }
    .tabcontent {
      display: none;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>ğŸ“š Spring Boot åšå®¢REST API æµ‹è¯•å¹³å°</h1>

  <div class="status-bar" id="status-bar">
    âœ… åº”ç”¨çŠ¶æ€: è¿è¡Œä¸­ | æœ€åæ£€æŸ¥: <span id="last-check">-</span>
  </div>

  <div class="token-section">
    <h3>ğŸ” JWT ä»¤ç‰Œç®¡ç†</h3>
    <input type="text" id="jwt-token" placeholder="ç²˜è´´JWTä»¤ç‰Œ (ä» /api/auth/signin è·å–)">
    <button class="auth-btn" onclick="setToken()">è®¾ç½®ä»¤ç‰Œ</button>
    <button class="auth-btn" onclick="testWithToken()">æµ‹è¯•å¸¦ä»¤ç‰Œçš„è¯·æ±‚</button>
    <button class="auth-btn" onclick="clearToken()">æ¸…é™¤ä»¤ç‰Œ</button>
    <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
      å½“å‰ä»¤ç‰ŒçŠ¶æ€: <span id="token-status">æœªè®¾ç½®</span>
    </div>
  </div>

  <div class="tab">
    <button class="tablinks active" onclick="openTab(event, 'public')">å…¬å…±API</button>
    <button class="tablinks" onclick="openTab(event, 'auth')">è®¤è¯API</button>
    <button class="tablinks" onclick="openTab(event, 'actuator')">ç³»ç»Ÿç›‘æ§</button>
    <button class="tablinks" onclick="openTab(event, 'custom')">è‡ªå®šä¹‰æµ‹è¯•</button>
  </div>

  <!-- å…¬å…±APIé€‰é¡¹å¡ -->
  <div id="public" class="tabcontent" style="display: block;">
    <div class="section">
      <h3>ğŸ“ åšå®¢æ–‡ç« </h3>
      <div class="endpoint-list">
        <div class="endpoint-card">
          <span class="method GET">GET</span>
          <div class="endpoint-path">/api/posts</div>
          <p>è·å–æ‰€æœ‰åšå®¢æ–‡ç« </p>
          <button class="test-btn" onclick="testEndpoint('GET', '/api/posts')">æµ‹è¯•</button>
        </div>
        <div class="endpoint-card">
          <span class="method POST">POST</span>
          <div class="endpoint-path">/api/posts</div>
          <p>åˆ›å»ºæ–°æ–‡ç«  (éœ€è¦è®¤è¯)</p>
          <button class="test-btn" onclick="testAuthEndpoint('POST', '/api/posts', createPostData)">æµ‹è¯•</button>
        </div>
      </div>
    </div>

    <div class="section">
      <h3>ğŸ—‚ï¸ ç›¸å†Œç®¡ç†</h3>
      <div class="endpoint-list">
        <div class="endpoint-card">
          <span class="method GET">GET</span>
          <div class="endpoint-path">/api/albums</div>
          <p>è·å–æ‰€æœ‰ç›¸å†Œ</p>
          <button class="test-btn" onclick="testEndpoint('GET', '/api/albums')">æµ‹è¯•</button>
        </div>
        <div class="endpoint-card">
          <span class="method GET">GET</span>
          <div class="endpoint-path">/api/photos</div>
          <p>è·å–æ‰€æœ‰ç…§ç‰‡</p>
          <button class="test-btn" onclick="testEndpoint('GET', '/api/photos')">æµ‹è¯•</button>
        </div>
      </div>
    </div>
  </div>

  <!-- è®¤è¯APIé€‰é¡¹å¡ -->
  <div id="auth" class="tabcontent">
    <div class="section">
      <h3>ğŸ‘¤ ç”¨æˆ·è®¤è¯</h3>
      <div class="endpoint-list">
        <div class="endpoint-card">
          <span class="method POST">POST</span>
          <div class="endpoint-path">/api/auth/signup</div>
          <p>ç”¨æˆ·æ³¨å†Œ</p>
          <button class="test-btn" onclick="testAuthSignup()">æµ‹è¯•æ³¨å†Œ</button>
        </div>
        <div class="endpoint-card">
          <span class="method POST">POST</span>
          <div class="endpoint-path">/api/auth/signin</div>
          <p>ç”¨æˆ·ç™»å½•</p>
          <button class="test-btn" onclick="testAuthSignin()">æµ‹è¯•ç™»å½•</button>
        </div>
        <div class="endpoint-card">
          <span class="method GET">GET</span>
          <div class="endpoint-path">/api/users/me</div>
          <p>è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ (éœ€è¦è®¤è¯)</p>
          <button class="test-btn" onclick="testAuthEndpoint('GET', '/api/users/me')">æµ‹è¯•</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ç³»ç»Ÿç›‘æ§é€‰é¡¹å¡ -->
  <div id="actuator" class="tabcontent">
    <div class="section">
      <h3>âš™ï¸ ç³»ç»Ÿç›‘æ§ç«¯ç‚¹</h3>
      <div class="endpoint-list">
        <div class="endpoint-card">
          <span class="method GET">GET</span>
          <div class="endpoint-path">/actuator</div>
          <p>æŸ¥çœ‹æ‰€æœ‰Actuatorç«¯ç‚¹</p>
          <button class="test-btn" onclick="testEndpoint('GET', '/actuator')">æµ‹è¯•</button>
        </div>
        <div class="endpoint-card">
          <span class="method GET">GET</span>
          <div class="endpoint-path">/actuator/health</div>
          <p>ç³»ç»Ÿå¥åº·æ£€æŸ¥</p>
          <button class="test-btn" onclick="testEndpoint('GET', '/actuator/health')">æµ‹è¯•</button>
        </div>
        <div class="endpoint-card">
          <span class="method GET">GET</span>
          <div class="endpoint-path">/actuator/info</div>
          <p>åº”ç”¨ä¿¡æ¯</p>
          <button class="test-btn" onclick="testEndpoint('GET', '/actuator/info')">æµ‹è¯•</button>
        </div>
        <div class="endpoint-card">
          <span class="method GET">GET</span>
          <div class="endpoint-path">/actuator/metrics</div>
          <p>ç³»ç»ŸæŒ‡æ ‡</p>
          <button class="test-btn" onclick="testEndpoint('GET', '/actuator/metrics')">æµ‹è¯•</button>
        </div>
      </div>
    </div>
  </div>

  <!-- è‡ªå®šä¹‰æµ‹è¯•é€‰é¡¹å¡ -->
  <div id="custom" class="tabcontent">
    <div class="section">
      <h3>ğŸ”§ è‡ªå®šä¹‰APIæµ‹è¯•</h3>
      <div>
        <label>è¯·æ±‚æ–¹æ³•:</label>
        <select id="custom-method">
          <option value="GET">GET</option>
          <option value="POST">POST</option>
          <option value="PUT">PUT</option>
          <option value="DELETE">DELETE</option>
        </select>

        <label style="margin-left: 20px;">APIç«¯ç‚¹:</label>
        <input type="text" id="custom-endpoint" placeholder="/api/posts" style="width: 300px; padding: 8px;">

        <button class="test-btn" onclick="customTest()" style="width: auto; margin-left: 10px;">å‘é€è¯·æ±‚</button>
      </div>

      <div style="margin-top: 15px;">
        <label>è¯·æ±‚ä½“ (JSON):</label><br>
        <textarea id="custom-body" rows="6" style="width: 100%; font-family: monospace; padding: 10px;"
                  placeholder='{"key": "value"}'></textarea>
      </div>
    </div>
  </div>

  <div class="result-area">
    <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
    <div class="loading" id="loading">
      <div>æ­£åœ¨å‘é€è¯·æ±‚ï¼Œè¯·ç¨å€™...</div>
    </div>
    <div id="result"></div>
  </div>
</div>

<script>
  // å…¨å±€å˜é‡
  let jwtToken = '';
  let lastCheckTime = new Date();

  // åˆå§‹åŒ–
  document.addEventListener('DOMContentLoaded', function() {
    updateStatusBar();
    loadTokenFromStorage();
  });

  // æ ‡ç­¾é¡µåˆ‡æ¢
  function openTab(evt, tabName) {
    const tabcontents = document.getElementsByClassName("tabcontent");
    for (let i = 0; i < tabcontents.length; i++) {
      tabcontents[i].style.display = "none";
    }

    const tablinks = document.getElementsByClassName("tablinks");
    for (let i = 0; i < tablinks.length; i++) {
      tablinks[i].className = tablinks[i].className.replace(" active", "");
    }

    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
  }

  // æ›´æ–°çŠ¶æ€æ 
  function updateStatusBar() {
    const now = new Date();
    document.getElementById('last-check').textContent = now.toLocaleTimeString();
    lastCheckTime = now;
  }

  // ä»¤ç‰Œç®¡ç†
  function setToken() {
    jwtToken = document.getElementById('jwt-token').value.trim();
    if (jwtToken) {
      localStorage.setItem('blogapi_jwt_token', jwtToken);
      document.getElementById('token-status').textContent = 'å·²è®¾ç½®';
      document.getElementById('token-status').style.color = '#28a745';
      showMessage('ä»¤ç‰Œå·²è®¾ç½®å¹¶ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨', 'success');
    } else {
      showMessage('è¯·è¾“å…¥æœ‰æ•ˆçš„JWTä»¤ç‰Œ', 'error');
    }
  }

  function loadTokenFromStorage() {
    const savedToken = localStorage.getItem('blogapi_jwt_token');
    if (savedToken) {
      jwtToken = savedToken;
      document.getElementById('jwt-token').value = savedToken;
      document.getElementById('token-status').textContent = 'å·²ä»å­˜å‚¨åŠ è½½';
      document.getElementById('token-status').style.color = '#28a745';
    }
  }

  function clearToken() {
    jwtToken = '';
    localStorage.removeItem('blogapi_jwt_token');
    document.getElementById('jwt-token').value = '';
    document.getElementById('token-status').textContent = 'æœªè®¾ç½®';
    document.getElementById('token-status').style.color = '#666';
    showMessage('ä»¤ç‰Œå·²æ¸…é™¤', 'info');
  }

  // æµ‹è¯•ç«¯ç‚¹ï¼ˆå…¬å…±ï¼‰
  async function testEndpoint(method, endpoint, body = null) {
    showLoading();
    updateStatusBar();

    try {
      const options = {
        method: method,
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        }
      };

      if (body) {
        options.body = JSON.stringify(body);
      }

      const response = await fetch(endpoint, options);
      const result = await parseResponse(response);

      displayResult({
        endpoint,
        method,
        status: response.status,
        ...result
      });

    } catch (error) {
      displayResult({
        error: error.message,
        endpoint,
        method
      }, true);
    } finally {
      hideLoading();
    }
  }

  // æµ‹è¯•éœ€è¦è®¤è¯çš„ç«¯ç‚¹
  async function testAuthEndpoint(method, endpoint, body = null) {
    if (!jwtToken) {
      showMessage('è¯·å…ˆè®¾ç½®JWTä»¤ç‰Œ', 'error');
      return;
    }

    showLoading();
    updateStatusBar();

    try {
      const options = {
        method: method,
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${jwtToken}`
        }
      };

      if (body) {
        options.body = JSON.stringify(body);
      }

      const response = await fetch(endpoint, options);
      const result = await parseResponse(response);

      displayResult({
        endpoint,
        method,
        status: response.status,
        ...result
      });

    } catch (error) {
      displayResult({
        error: error.message,
        endpoint,
        method
      }, true);
    } finally {
      hideLoading();
    }
  }

  // æµ‹è¯•ç”¨æˆ·æ³¨å†Œ
  async function testAuthSignup() {
    const userData = {
      firstName: "Test",
      lastName: "User",
      username: `testuser_${Date.now()}`,
      password: "password123",
      email: `test_${Date.now()}@example.com`
    };

    await testEndpoint('POST', '/api/auth/signup', userData);
  }

  // æµ‹è¯•ç”¨æˆ·ç™»å½•
  async function testAuthSignin() {
    const loginData = {
      usernameOrEmail: "leanne",
      password: "password"
    };

    showLoading();

    try {
      const response = await fetch('/api/auth/signin', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(loginData)
      });

      const result = await parseResponse(response);

      if (result.data && result.data.accessToken) {
        jwtToken = result.data.accessToken;
        document.getElementById('jwt-token').value = jwtToken;
        localStorage.setItem('blogapi_jwt_token', jwtToken);
        document.getElementById('token-status').textContent = 'å·²ä»ç™»å½•è·å–';
        document.getElementById('token-status').style.color = '#28a745';
        showMessage('ç™»å½•æˆåŠŸï¼ä»¤ç‰Œå·²è‡ªåŠ¨ä¿å­˜', 'success');
      }

      displayResult({
        endpoint: '/api/auth/signin',
        method: 'POST',
        status: response.status,
        ...result
      });

    } catch (error) {
      displayResult({
        error: error.message,
        endpoint: '/api/auth/signin',
        method: 'POST'
      }, true);
    } finally {
      hideLoading();
    }
  }

  // ä½¿ç”¨ä»¤ç‰Œæµ‹è¯•
  async function testWithToken() {
    if (!jwtToken) {
      showMessage('è¯·å…ˆè®¾ç½®JWTä»¤ç‰Œ', 'error');
      return;
    }

    // æµ‹è¯•è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
    await testAuthEndpoint('GET', '/api/users/me');
  }

  // è‡ªå®šä¹‰æµ‹è¯•
  async function customTest() {
    const method = document.getElementById('custom-method').value;
    const endpoint = document.getElementById('custom-endpoint').value.trim();
    const bodyText = document.getElementById('custom-body').value.trim();

    if (!endpoint) {
      showMessage('è¯·è¾“å…¥APIç«¯ç‚¹', 'error');
      return;
    }

    let body = null;
    if (bodyText) {
      try {
        body = JSON.parse(bodyText);
      } catch (e) {
        showMessage('è¯·æ±‚ä½“ä¸æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼', 'error');
        return;
      }
    }

    // åˆ¤æ–­æ˜¯å¦éœ€è¦è®¤è¯
    const isAuthRequired = !endpoint.includes('/auth/') &&
            !endpoint.startsWith('/actuator') &&
            !endpoint.startsWith('/api/posts') &&
            !endpoint.startsWith('/api/albums') &&
            !endpoint.startsWith('/api/photos');

    if (isAuthRequired && jwtToken) {
      await testAuthEndpoint(method, endpoint, body);
    } else if (isAuthRequired && !jwtToken) {
      showMessage('æ­¤ç«¯ç‚¹éœ€è¦è®¤è¯ï¼Œä½†æœªè®¾ç½®JWTä»¤ç‰Œ', 'error');
    } else {
      await testEndpoint(method, endpoint, body);
    }
  }

  // è§£æå“åº”
  async function parseResponse(response) {
    const contentType = response.headers.get('content-type');

    if (contentType && contentType.includes('application/json')) {
      return {
        contentType: 'application/json',
        data: await response.json()
      };
    } else {
      const text = await response.text();
      return {
        contentType: contentType || 'text/plain',
        data: text
      };
    }
  }

  // æ˜¾ç¤ºç»“æœ
  function displayResult(result, isError = false) {
    const resultDiv = document.getElementById('result');
    let output = '';

    if (isError) {
      output += 'âŒ è¯·æ±‚å¤±è´¥\n\n';
      output += `é”™è¯¯: ${result.error}\n`;
      if (result.endpoint) {
        output += `ç«¯ç‚¹: ${result.endpoint}\n`;
      }
      if (result.method) {
        output += `æ–¹æ³•: ${result.method}\n`;
      }
    } else {
      output += `âœ… è¯·æ±‚æˆåŠŸ (çŠ¶æ€ç : ${result.status})\n\n`;
      output += `ç«¯ç‚¹: ${result.method} ${result.endpoint}\n`;
      output += `å“åº”ç±»å‹: ${result.contentType}\n\n`;

      if (typeof result.data === 'string') {
        output += `å“åº”å†…å®¹:\n${result.data.substring(0, 1000)}`;
        if (result.data.length > 1000) {
          output += '\n... (å†…å®¹å·²æˆªæ–­)';
        }
      } else {
        output += `å“åº”æ•°æ®:\n${JSON.stringify(result.data, null, 2)}`;
      }
    }

    resultDiv.textContent = output;
    resultDiv.style.background = isError ? '#f8d7da' : '#d1ecf1';
    resultDiv.style.color = isError ? '#721c24' : '#0c5460';
  }

  // è¾…åŠ©å‡½æ•°
  function showLoading() {
    document.getElementById('loading').style.display = 'block';
  }

  function hideLoading() {
    document.getElementById('loading').style.display = 'none';
  }

  function showMessage(message, type = 'info') {
    const colors = {
      success: '#d4edda',
      error: '#f8d7da',
      info: '#d1ecf1',
      warning: '#fff3cd'
    };

    const messageDiv = document.createElement('div');
    messageDiv.textContent = message;
    messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px;
                border-radius: 5px;
                background: ${colors[type]};
                color: ${type === 'error' ? '#721c24' : '#155724'};
                z-index: 1000;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            `;

    document.body.appendChild(messageDiv);

    setTimeout(() => {
      messageDiv.remove();
    }, 3000);
  }

  // ç¤ºä¾‹æ•°æ®
  const createPostData = {
    "title": "æµ‹è¯•æ–‡ç« æ ‡é¢˜",
    "body": "è¿™æ˜¯æµ‹è¯•æ–‡ç« çš„å†…å®¹..."
  };

  // åˆå§‹æµ‹è¯•
  setTimeout(() => {
    testEndpoint('GET', '/');
    testEndpoint('GET', '/actuator');
  }, 1000);
</script>
</body>
</html>